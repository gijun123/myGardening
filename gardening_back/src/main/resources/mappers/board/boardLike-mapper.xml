<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ggirick.gardening_back.mappers.board.BoardLikeMapper">

    <!-- 좋아요 추가 -->
    <insert id="insertLike">
        INSERT INTO BOARD_LIKE (
            ID, BOARD_ID, USER_UID, CREATED_AT
        ) VALUES (
                     BOARD_LIKE_SEQ.NEXTVAL,
                     #{boardId},
                     #{loginUid},
                     SYSTIMESTAMP
                 )
    </insert>

    <!-- 좋아요 취소 -->
    <delete id="deleteLike">
        DELETE FROM BOARD_LIKE
        WHERE BOARD_ID = #{boardId}
          AND USER_UID = #{loginUid}
    </delete>

    <!-- 좋아요 여부 -->
    <select id="existsLike" resultType="boolean">
        SELECT CASE WHEN COUNT(*) > 0 THEN 1 ELSE 0 END
        FROM BOARD_LIKE
        WHERE BOARD_ID = #{boardId}
          AND USER_UID = #{loginUid}
    </select>

    <!-- 좋아요 카운트 증가 -->
    <update id="increaseLikeCount">
        UPDATE BOARD
        SET LIKE_COUNT = LIKE_COUNT + 1
        WHERE ID = #{boardId}
    </update>

    <!-- 좋아요 카운트 감소 -->
    <update id="decreaseLikeCount">
        UPDATE BOARD
        SET LIKE_COUNT = LIKE_COUNT - 1
        WHERE ID = #{boardId}
    </update>

    <!-- 내 좋아요 게시글 목록 조회 -->
    <select id="getLikedList" resultType="com.ggirick.gardening_back.dto.board.BoardResponseDTO">
        SELECT
            b.ID,
            b.TITLE,
            b.CONTENTS,
            b.WRITER_UID,
            b.VIEW_COUNT,
            b.LIKE_COUNT,
            b.IS_NOTIFICATION,
            b.CREATED_AT,
            b.UPDATED_AT
        FROM BOARD_LIKE l
                 JOIN BOARD b ON l.BOARD_ID = b.ID
        WHERE l.USER_UID = #{userUid}
        ORDER BY b.CREATED_AT DESC
    </select>

</mapper>
